# JSON è§£æå™¨è°ƒè¯•æŒ‡å—

## æ¦‚è¿°

ä¸ºäº†æ’æŸ¥ JSON è§£æå™¨çš„é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨ `JsonReviewResultParser` ä¸­æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•è¾“å‡ºåŠŸèƒ½ã€‚

## è°ƒè¯•ä¿¡æ¯è¯´æ˜

å½“ JSON è§£æå™¨è¿è¡Œæ—¶ï¼Œä¼šè¾“å‡ºä»¥ä¸‹è°ƒè¯•ä¿¡æ¯ï¼š

### 1. åŸå§‹ LLM è¾“å‡º

```
ğŸ“ Raw LLM output (first 500 chars):
[LLM è¾“å‡ºçš„å‰ 500 ä¸ªå­—ç¬¦]

ğŸ“ Raw LLM output (last 500 chars):
[LLM è¾“å‡ºçš„å 500 ä¸ªå­—ç¬¦]

ğŸ“ Total output length: [æ€»å­—ç¬¦æ•°] characters
```

### 2. æ¸…ç†åçš„å†…å®¹

```
ğŸ§¹ Cleaned result (first 500 chars):
[æ¸…ç†åå†…å®¹çš„å‰ 500 ä¸ªå­—ç¬¦]

ğŸ§¹ Cleaned result (last 500 chars):
[æ¸…ç†åå†…å®¹çš„å 500 ä¸ªå­—ç¬¦]

ğŸ“ Cleaned length: [æ¸…ç†åå­—ç¬¦æ•°] characters
```

### 3. é”™è¯¯è¯¦æƒ…ï¼ˆå¦‚æœè§£æå¤±è´¥ï¼‰

```
âŒ Failed to parse JSON review result: [é”™è¯¯ä¿¡æ¯]

ğŸ” JSON Syntax Error Details:
   Error message: [è¯¦ç»†é”™è¯¯ä¿¡æ¯]
   Context around position [ä½ç½®]:
   "[é”™è¯¯ä½ç½®å‘¨å›´çš„å†…å®¹]"
     ^
```

## ä½¿ç”¨æ–¹æ³•

1. **è¿è¡Œ Bugment**ï¼šæ­£å¸¸è¿è¡Œ Bugment è¿›è¡Œä»£ç å®¡æŸ¥
2. **æŸ¥çœ‹æ—¥å¿—**ï¼šåœ¨ GitHub Actions æ—¥å¿—ä¸­æŸ¥æ‰¾ä¸Šè¿°è°ƒè¯•ä¿¡æ¯
3. **åˆ†æé—®é¢˜**ï¼šæ ¹æ®è°ƒè¯•ä¿¡æ¯åˆ†æ LLM è¾“å‡ºæ ¼å¼é—®é¢˜

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šLLM è¾“å‡ºåŒ…å«é¢å¤–å†…å®¹

**ç—‡çŠ¶**ï¼šé”™è¯¯ä¿¡æ¯æ˜¾ç¤º "Unexpected non-whitespace character after JSON"
**è§£å†³**ï¼šæ£€æŸ¥ LLM è¾“å‡ºçš„å 500 å­—ç¬¦ï¼Œçœ‹æ˜¯å¦åœ¨ JSON åé¢æœ‰é¢å¤–çš„æ–‡æœ¬

### é—®é¢˜ 2ï¼šLLM è¾“å‡ºä»ç„¶æ˜¯ Markdown æ ¼å¼

**ç—‡çŠ¶**ï¼šåŸå§‹è¾“å‡ºæ˜¾ç¤º Markdown æ ¼å¼è€Œä¸æ˜¯ JSON
**è§£å†³**ï¼šæ£€æŸ¥ prompt.md æ¨¡æ¿æ˜¯å¦æ­£ç¡®æ›´æ–°ï¼Œæˆ–è€… LLM æ˜¯å¦éœ€è¦æ›´å¤šæ—¶é—´é€‚åº”æ–°æ ¼å¼

### é—®é¢˜ 3ï¼šJSON æ ¼å¼é”™è¯¯

**ç—‡çŠ¶**ï¼šè¯­æ³•é”™è¯¯ï¼Œå¦‚ç¼ºå°‘å¼•å·ã€é€—å·ç­‰
**è§£å†³**ï¼šæŸ¥çœ‹é”™è¯¯ä½ç½®çš„ä¸Šä¸‹æ–‡ï¼Œæ£€æŸ¥ JSON æ ¼å¼æ˜¯å¦æ­£ç¡®

## é—®é¢˜è§£å†³æ–¹æ¡ˆ

å¦‚æœ JSON è§£æå™¨å‡ºç°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. æ£€æŸ¥ LLM è¾“å‡ºæ ¼å¼æ˜¯å¦æ­£ç¡®
2. æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯å®šä½å…·ä½“é—®é¢˜
3. æ ¹æ®é”™è¯¯ä¿¡æ¯è°ƒæ•´ prompt æ¨¡æ¿

## è°ƒè¯•ä¿¡æ¯ç¤ºä¾‹

### æˆåŠŸè§£æçš„ç¤ºä¾‹

```
ğŸ” Starting to parse JSON review result...
ğŸ“ Raw LLM output (first 500 chars):
{
  "summary": {
    "overallComments": [
      "ä»£ç æ•´ä½“ç»“æ„æ¸…æ™°ï¼Œéµå¾ªäº†è‰¯å¥½çš„ç¼–ç¨‹å®è·µ"
    ]
  },
  "issues": [
    {
      "id": "bug_1",
      "type": "bug",
      "severity": "medium",
      "title": "æ½œåœ¨çš„ç©ºæŒ‡é’ˆå¼‚å¸¸"
    }
  ]
}

âœ… JSON parsing complete. Found 1 total issues
```

### è§£æå¤±è´¥çš„ç¤ºä¾‹

```
ğŸ” Starting to parse JSON review result...
ğŸ“ Raw LLM output (first 500 chars):
{
  "summary": {
    "overallComments": [
      "ä»£ç æ•´ä½“ç»“æ„æ¸…æ™°"
    ]
  },
  "issues": []
}

è¿™æ˜¯ä¸€äº›é¢å¤–çš„æ–‡æœ¬å†…å®¹...

âŒ Failed to parse JSON review result: SyntaxError: Unexpected non-whitespace character after JSON at position 123
ğŸ” JSON Syntax Error Details:
   Error message: Unexpected non-whitespace character after JSON at position 123
   Context around position 123:
   "}

è¿™æ˜¯ä¸€äº›é¢å¤–çš„æ–‡æœ¬å†…å®¹..."
     ^
```

## ç§»é™¤è°ƒè¯•ä¿¡æ¯

å½“é—®é¢˜è§£å†³åï¼Œå¯ä»¥ç§»é™¤è°ƒè¯•è¾“å‡ºä»¥å‡å°‘æ—¥å¿—å™ªéŸ³ã€‚åªéœ€è¦åˆ é™¤ `JsonReviewResultParser.ts` ä¸­çš„è°ƒè¯•ç›¸å…³ä»£ç å³å¯ã€‚

## æ³¨æ„äº‹é¡¹

- è°ƒè¯•ä¿¡æ¯ä¼šå¢åŠ æ—¥å¿—è¾“å‡ºé‡ï¼Œå»ºè®®é—®é¢˜è§£å†³ååŠæ—¶ç§»é™¤
- æ•æ„Ÿä¿¡æ¯å¯èƒ½ä¼šå‡ºç°åœ¨è°ƒè¯•è¾“å‡ºä¸­ï¼Œæ³¨æ„ä¿æŠ¤éšç§
- è°ƒè¯•ä¿¡æ¯æœ‰åŠ©äºå¿«é€Ÿå®šä½é—®é¢˜ï¼Œä½†ä¸åº”åœ¨ç”Ÿäº§ç¯å¢ƒé•¿æœŸä¿ç•™
